## Network Programming

### The Client-Server Programming Model

- It is important to realize that clients and servers are processes and not machines, or hosts as they are often called in this context

![](./client_server_transaction.png)

### Networks

- Hardware organization:

![](./hardare_organization_of_a_network_host.png)

- Data received from the network are copied from the adapter across the I/O and memory buses into memory, typically by a DMA transfer

- An **Ethernet segment** consists of some wires (usually twisted pairs of wires) and a small box called a **hub**:

![](./ethernet_segment.png)

- Every host adapter sees the frame, but only the destination host actually reads it
- Multiple Ethernet segments can be connected into larger LANs, called **bridged Ethernets**, using a set of wires and small boxes called bridges:

![](./bridged_ethernet_segment.png)

- Using a clever distributed algorithm, they automatically learn over time which hosts are reachable from which ports and then selectively copy frames from one port to another only when it is necessary

- At a higher level in the hierarchy, multiple incompatible LANs can be connected by specialized computers called routersto form an internet (interconnected network)

- The crucial property of an internet is that it can consist of different LANs and WANs with radically different and incompatible technologies:

![](./a_small_internet.png)

- How hosts and routers use the internet protocol to transfer data across incompatible LANs:

![](./how_data_travel_from_one_host_to_another_on_an_internet.png)

### The Global IP Internet

- Hardware and software organization of an internet application

![](./hardare_organization_of_a_network_host.png)

- The sockets functions are typically implemented as system calls that trap into the kernel and call various kernel-mode functions in TCP/IP
- The IP mechanism is unreliable in the sense that it makes no effort to recover if datagrams are lost or duplicated in the network
- UDP (Unreliable Datagram Protocol) extends IP slightly, so that datagrams can be transferred from process to process, rather than host to host
- TCP is a complex protocol that builds on IP to provide reliable full duplex (bidirectional) connections between processes

#### IP Addresses

- Network programs store IP addresses in the IP address structure:

```c
/* IP address structure */
struct in_addr {
  uint32_t s_addr; /* Address in network byte order (big-endian) */
};
```

- It would make more sense to define a scalar type for IP addresses, but it is too late to change now because of the enormous installed base of applications
- TCP/IP defines a uniform network byte order (big-endian byte order) for any integer data item
- Unix provides the following functions for converting between network and host byte order:

```c
#include <arpa/inet.h>

// Returns: value in network byte order
uint32_t htonl(uint32_t hostlong);
uint16_t htons(uint16_t hostshort);

// Returns: value in host byte order
uint32_t ntohl(uint32_t netlong);
uint16_t ntohs(uint16_t netshort);
```

- eg. `128.2.194.242` is the dotted-decimal representation of the address `0x8002c2f2`
- Application programs can convert back and forth between IP addresses and dotted-decimal strings using the functions `inet_pton` and `inet_ntop`

```c
#include <arpa/inet.h>

// Returns: 1 if OK, 0 if src is invalid dotted decimal, âˆ’1 on error
int inet_pton(AF_INET, const char *src, void *dst);

// Returns: pointer to a dotted-decimal string if OK, NULL on error
const char *inet_ntop(AF_INET, const void *src, char *dst, socklen_t size);
```

#### Internet Domain Names

- The set of domain names forms a hierarchy, and each domain name encodes its position in the hierarchy
- The nodes of the tree represent domain names that are formed by the path back to the root

![](./subset_of_the_internet_domain_name_hierarchy.png)

- The Internet defines a mapping between the set of domain names and the set of IP addresses
- Linux nslookup program, which displays the IP addresses associated with a domain name, eg.

```bash
linux> nslookup localhost
Address: 127.0.0.1
```

#### Internet Connections

- A socket is an end point of a connection
- Each socket has a corresponding socket address that consists of an Internet address and a 16-bit integer port and is denoted by the notation address:port
- The mapping between well-known names and well-known ports is contained in a file called `/etc/services`
- A connection is uniquely identified by the socket addresses of its two end points. This pair of socket addresses is known as a socket pair and is denoted by the tuple:

```
(cliaddr:cliport, servaddr:servport)
```

![](./anatomy_of_an_internet_connection.png)

- 
